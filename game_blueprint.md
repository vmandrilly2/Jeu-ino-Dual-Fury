这份文件将作为整个项目的“唯一真实来源 (Single Source of Truth)”。AI可以精确地根据这份文档来生成代码框架、类和函数。
---

# **项目蓝图: 双人合作生存游戏 (Project: Dual Fury)**

**版本:** 1.0
**目标:** 本文档旨在为AI代码生成工具提供一个完整、清晰的游戏开发蓝图。所有功能、系统和技术选型均在此定义。

---

## **1. 游戏设计图 (GDD) 核心解读**

本文档基于用户提供的原始手绘设计图。该图描绘了一个双人合作、俯视角的动作生存游戏。

*   **核心玩法:** 两名玩家在同一屏幕上，合作对抗从屏幕四方不断涌来的敌人（波次系统）。玩家通过击败敌人获得经验值（XP）并升级（LV），升级后可以选择技能来增强自己，目标是生存尽可能长的时间。
*   **玩家1 (左侧):**
    *   **控制:** `W/A/S/D` 移动, `Q` 攻击。
    *   **状态:** HP: 95, XP: 3/25, LV: 1。
*   **玩家2 (右侧):**
    *   **控制:** 方向键 `↑/↓/←/→` 移动, `K` 攻击。
    *   **状态:** HP: 85, XP: 2/50, LV: 6。
    *   **特殊物品:** 图中显示了 `(7+)x4` 和 `(伤+2)x1`，这被解读为可拾取或通过技能获得的增益（Buff）或主动技能。
*   **敌人系统:**
    *   敌人以波次（`第1波`）的形式出现。
    *   在特定波次后会出现强大的BOSS（`BOSS HP:500`）。
*   **游戏流程:**
    *   游戏按波次进行，一波结束后会进入下一波（`下一波`）。
    *   游戏难度会随着波次增加。

---

## **2. 技术选型 (Technical Blueprint)**

*   **核心库/引擎:** **Pygame**
    *   **理由:** 轻量级，非常适合2D游戏开发，纯Python实现，学习曲线平缓，足以实现本文档中定义的所有功能。
*   **编程语言:** Python 3.9+
*   **建议文件结构:**
    ```
    dual_fury/
    ├── main.py             # 游戏主入口和主循环
    ├── settings.py         # 存放屏幕尺寸、FPS、颜色等常量
    ├── assets/
    │   ├── sprites/        # 玩家、敌人、特效等图片
    │   ├── sounds/         # 攻击、受伤、背景音乐等音效
    │   └── fonts/          # 游戏字体
    └── src/
        ├── player.py       # Player 类
        ├── enemy.py        # Enemy 基类和具体敌人子类
        ├── skill.py        # Skill 数据结构和管理
        ├── weapon.py       # 近战武器/Hitbox类
        ├── ui.py           # UI界面元素（血条、经验条等）
        ├── manager.py      # 游戏管理器（波次、状态等）
    ```

---

## **3. 核心功能详尽列表 (Feature Breakdown)**

### **3.1 玩家系统 (Player System)**

*   **Player 类 (`player.py`):**
    *   **属性:** `player_id` (1 or 2), `hp`, `max_hp`, `level`, `xp`, `xp_to_next_level`, `speed`, `skills` (列表), `is_alive`。
    *   **初始化:** 根据 `player_id` 设置不同的初始位置、控制按键。
    *   **移动:** 8方向移动。
    *   **攻击:**
        *   **近战攻击:** 攻击方式为近战。
        *   **实现方式:** 创建一个与玩家关联的 **Hitbox** (使用 `pygame.Rect` 或一个子Sprite)。
        *   **攻击逻辑:** 按下攻击键时，激活Hitbox一小段时间（例如0.2秒），然后禁用。在此期间，检测与敌人的碰撞。
        *   **攻击冷却:** 每次攻击后有短暂的冷却时间。
    *   **受伤 (`take_damage` 方法):** 减少HP，并提供短暂的无敌帧（闪烁效果）以避免被秒杀。
    *   **死亡:** HP降至0时，`is_alive` 变为 `False`。当两名玩家都死亡时，游戏结束。
    *   **经验与升级:**
        *   **`add_xp(amount)` 方法:** 增加经验值。如果当前经验值达到或超过 `xp_to_next_level`，则调用 `level_up()`。
        *   **`level_up()` 方法:**
            1.  等级+1。
            2.  将溢出的经验值保留到下一级。
            3.  **重新计算下一级所需经验**，使用以下公式：
                ```
                tier = floor((new_level - 1) / 5)
                required_xp = 25 + (tier * 25)
                ```
            4.  生命值回满。
            5.  **触发技能选择界面**。

### **3.2 技能系统 (Skill System)**

*   **技能池:** 在 `skill.py` 或 `settings.py` 中定义所有可用技能。
*   **升级选择:**
    *   当玩家 `level_up()` 时，游戏暂停。
    *   弹出一个UI界面，从**技能池**中**随机选择3个**不同的、玩家尚未满级的技能供玩家选择。
    *   玩家选择一个后，游戏继续。
*   **技能列表 (在 `skill.py` 中定义):**
    *   **攻击类:**
        *   `强力挥击`: 伤害 +10% (可叠加)。
        *   `剑气纵横`: 攻击范围 +15% (可叠加)。
        *   `致命一击`: 10% 暴击率，造成2倍伤害。
        *   `旋风斩`: 攻击模式变为持续旋转攻击。
        *   `震荡波`: 每3次攻击释放一道穿透剑气。
        *   `斩杀`: 对低血量小怪直接秒杀。
    *   **防御与生存类:**
        *   `体魄增强`: 最大HP +20 (可叠加)。
        *   `吸血之刃`: 攻击造成伤害的5%转化为自身HP。
        *   `再生`: 每5秒恢复1%最大HP。
        *   `闪避冲刺`: 获得一个短暂无敌的位移技能。
        *   `守护光环`: 减伤10%。
    *   **控制与功能类:**
        *   `寒冰之触`: 攻击减速敌人。
        *   `震荡打击`: 攻击有几率击晕敌人。
        *   `身法灵动`: 移速 +10% (可叠加)。
        *   `磁力吸引`: 自动拾取经验范围扩大。
    *   **双人协作类:**
        *   `领袖光环`: 附近队友和自己伤害 +5%。
        *   `生命链接`: 治疗效果分享给队友。
        *   `协同作战`: 短时间内攻击同一目标造成额外伤害。
        *   `战场援护`: 队友低血量时自身获得增益。

### **3.3 敌人与波次系统 (Enemy & Wave System)**

*   **Enemy 基类 (`enemy.py`):**
    *   **属性:** `hp`, `max_hp`, `speed`, `damage` (碰撞伤害), `xp_reward`。
    *   **AI逻辑:** 简单向下移动，或朝最近的玩家移动。
    *   **受伤与死亡:** `take_damage` 方法，死亡时掉落经验值（创建一个经验球或直接给予玩家）。
*   **难度递增:**
    *   **HP增长:** 敌人的HP根据波次增加。使用以下公式：
        ```
        current_hp = base_hp + (current_wave - 1) * 10
        ```
*   **GameManager/WaveManager (`manager.py`):**
    *   **`current_wave` 变量:** 追踪当前波次。
    *   **`spawn_wave()` 方法:** 根据 `current_wave` 决定生成敌人的数量、种类和HP。
    *   **`update()` 方法:** 持续检查当前场上是否还有敌人。如果没有，则进入“波次间歇”，几秒后调用 `spawn_wave()` 开始下一波。
*   **Boss:**
    *   一个继承自 Enemy 的特殊子类，拥有更高的HP和独特的攻击模式（待定）。
    *   在特定波次（如第5或第10波）的末尾生成。

### **3.4 UI/HUD 系统 (`ui.py`)**

*   **玩家状态显示:**
    *   为每个玩家在屏幕角落（左上角和右上角）显示HP条、XP条、等级。
*   **波次显示:**
    *   在屏幕中央或顶部显示当前是 "Wave: X"。
*   **技能选择界面:**
    *   游戏暂停时弹出的全屏或半透明界面。
    *   显示3个技能选项，包含图标、名称和简短描述。
    *   支持键盘或鼠标选择。
*   **游戏结束画面:**
    *   当所有玩家死亡时显示 "Game Over"，并显示最终坚持的波数和得分。

### **3.5 游戏主循环 (`main.py`)**

*   **状态管理:** 包含 `MAIN_MENU`, `PLAYING`, `GAME_OVER` 等游戏状态。
*   **初始化:** 设置Pygame窗口，创建玩家实例，创建GameManager实例。
*   **主循环:**
    1.  **事件处理 (Event Handling):** 监听键盘输入（玩家移动、攻击、UI选择）、退出事件。
    2.  **更新 (Update):**
        *   根据输入更新玩家位置和状态。
        *   更新所有敌人的位置和状态。
        *   进行碰撞检测（玩家Hitbox vs 敌人，玩家 vs 敌人）。
        *   更新GameManager（检查波次是否结束）。
        *   更新UI元素。
    3.  **渲染 (Render):**
        *   清空屏幕。
        *   绘制背景、所有敌人、所有玩家。
        *   绘制特效（攻击动画、受伤闪烁）。
        *   绘制UI。
        *   更新显示 (`pygame.display.flip()`)。

---
**给Trae AI的最终指令:**
请根据以上蓝图文件，使用Pygame库生成一个结构清晰、代码可读性强的Python项目。请优先创建各个类的框架（包含属性和方法名），然后再填充具体逻辑。使用`settings.py`来管理所有常量，以便于后续调整游戏平衡。